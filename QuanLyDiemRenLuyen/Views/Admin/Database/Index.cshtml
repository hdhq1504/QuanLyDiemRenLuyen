@model QuanLyDiemRenLuyen.Models.DatabaseDashboardViewModel
@{
    ViewBag.Title = "Quản trị Database";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div style="padding: 24px;">
    <!-- Statistics Cards -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 16px; margin-bottom: 32px;">
        <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
            <div style="color: #64748b; font-size: 14px; margin-bottom: 8px;">Tổng Tablespaces</div>
            <div style="font-size: 32px; font-weight: 700; color: #2563eb;">@Model.TotalTablespaces</div>
        </div>

        <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
            <div style="color: #64748b; font-size: 14px; margin-bottom: 8px;">Usage cao nhất</div>
            <div style="font-size: 32px; font-weight: 700; color: @(Model.HighestUsagePercent >= 85 ? "#ef4444" : "#10b981");">
                @Model.HighestUsagePercent.ToString("0.0")%
            </div>
        </div>

        <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
            <div style="color: #64748b; font-size: 14px; margin-bottom: 8px;">Active Sessions</div>
            <div style="font-size: 32px; font-weight: 700; color: #10b981;">
                @Model.ActiveSessionCount / @Model.TotalSessions
            </div>
        </div>

        <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
            <div style="color: #64748b; font-size: 14px; margin-bottom: 8px;">Cảnh báo</div>
            <div style="font-size: 32px; font-weight: 700; color: #f59e0b;">
                @(Model.HighUsageTablespaceCount + Model.LongRunningSessions)
            </div>
        </div>
    </div>

    <!-- Tablespaces Section -->
    <div style="background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin-bottom: 24px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="font-size: 20px; font-weight: 700; color: #0f172a; margin: 0;">
                <i class="fas fa-hdd"></i> Top 5 Tablespaces
            </h3>
            <a href="@Url.Action("Tablespaces", "Database")" style="color: #2563eb; text-decoration: none; font-weight: 600;">
                Xem tất cả <i class="fas fa-arrow-right"></i>
            </a>
        </div>

        @if (Model.TopTablespaces != null && Model.TopTablespaces.Any())
        {
            <table style="width: 100%; border-collapse: collapse;">
                <thead style="background: #f8fafc; border-bottom: 2px solid #e2e8f0;">
                    <tr>
                        <th style="padding: 12px; text-align: left; font-weight: 600; color: #64748b;">Tablespace</th>
                        <th style="padding: 12px; text-align: right; font-weight: 600; color: #64748b;">Total (MB)</th>
                        <th style="padding: 12px; text-align: right; font-weight: 600; color: #64748b;">Used (MB)</th>
                        <th style="padding: 12px; text-align: right; font-weight: 600; color: #64748b;">Free (MB)</th>
                        <th style="padding: 12px; text-align: left; font-weight: 600; color: #64748b;">Usage</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var ts in Model.TopTablespaces)
                    {
                        <tr style="border-bottom: 1px solid #f1f5f9;">
                            <td style="padding: 12px; font-weight: 600;">@ts.Name</td>
                            <td style="padding: 12px; text-align: right;">@ts.TotalSpaceMB.ToString("N2")</td>
                            <td style="padding: 12px; text-align: right;">@ts.UsedSpaceMB.ToString("N2")</td>
                            <td style="padding: 12px; text-align: right;">@ts.FreeSpaceMB.ToString("N2")</td>
                            <td style="padding: 12px;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div style="flex: 1; background: #e5e7eb; border-radius: 4px; height: 8px; overflow: hidden;">
                                        <div style="background: @ts.GetUsageColor(); height: 100%; width: @ts.UsagePercent%"></div>
                                    </div>
                                    <span style="font-weight: 600; color: @ts.GetUsageColor(); min-width: 50px;">
                                        @ts.UsagePercent.ToString("0.0")%
                                    </span>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <p style="text-align: center; color: #9ca3af; padding: 40px;">Không có dữ liệu</p>
        }
    </div>

    <!-- Recent Sessions Section -->
    <div style="background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="font-size: 20px; font-weight: 700; color: #0f172a; margin: 0;">
                <i class="fas fa-users"></i> Sessions gần đây
            </h3>
            <a href="@Url.Action("Sessions", "Database")" style="color: #2563eb; text-decoration: none; font-weight: 600;">
                Xem tất cả <i class="fas fa-arrow-right"></i>
            </a>
        </div>

        @if (Model.RecentSessions != null && Model.RecentSessions.Any())
        {
            <table style="width: 100%; border-collapse: collapse;">
                <thead style="background: #f8fafc; border-bottom: 2px solid #e2e8f0;">
                    <tr>
                        <th style="padding: 12px; text-align: left; font-weight: 600; color: #64748b;">SID</th>
                        <th style="padding: 12px; text-align: left; font-weight: 600; color: #64748b;">Username</th>
                        <th style="padding: 12px; text-align: left; font-weight: 600; color: #64748b;">Status</th>
                        <th style="padding: 12px; text-align: left; font-weight: 600; color: #64748b;">Machine</th>
                        <th style="padding: 12px; text-align: left; font-weight: 600; color: #64748b;">Program</th>
                        <th style="padding: 12px; text-align: right; font-weight: 600; color: #64748b;">Duration</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var session in Model.RecentSessions)
                    {
                        <tr style="border-bottom: 1px solid #f1f5f9;">
                            <td style="padding: 12px; font-weight: 600;">@session.Sid</td>
                            <td style="padding: 12px;">@session.Username</td>
                            <td style="padding: 12px;">
                                <span style="background: @(session.Status == "ACTIVE" ? "#d1fae5" : "#e5e7eb"); color: @(session.Status == "ACTIVE" ? "#065f46" : "#374151"); padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;">
                                    @session.Status
                                </span>
                            </td>
                            <td style="padding: 12px; font-size: 13px;">@session.Machine</td>
                            <td style="padding: 12px; font-size: 13px;">@session.Program</td>
                            <td style="padding: 12px; text-align: right; color: #64748b;">@session.MinutesConnected phút</td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <p style="text-align: center; color: #9ca3af; padding: 40px;">Không có session nào</p>
        }
    </div>
</div>
