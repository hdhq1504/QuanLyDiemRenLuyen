@model QuanLyDiemRenLuyen.Models.StudentProfileViewModel
@{
    ViewBag.Title = "H·ªì S∆° Sinh Vi√™n";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .profile-container {
        max-width: 1200px;
        margin: 32px auto;
        padding: 0 24px;
    }

    .profile-header {
        background: #2563eb;
        color: white;
        padding: 32px;
        border-radius: 8px;
        margin-bottom: 32px;
        display: flex;
        align-items: center;
        gap: 24px;
        border: 1px solid #e2e8f0;
    }

    .profile-avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: white;
        color: #2563eb;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 40px;
        font-weight: 700;
        border: 3px solid white;
    }

    .profile-info h1 {
        margin: 0 0 8px 0;
        font-size: 28px;
        font-weight: 600;
    }

    .profile-info p {
        margin: 4px 0;
        font-size: 14px;
    }

    .edit-btn {
        background: white;
        color: #2563eb;
        padding: 10px 20px;
        border: 1px solid white;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
        margin-top: 12px;
        font-size: 14px;
    }

    .edit-btn:hover {
        background: #dbeafe;
        color: #2563eb;
        text-decoration: none;
    }

    .profile-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
    }

    .info-card {
        background: white;
        padding: 24px;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
    }

    .info-card h2 {
        color: #0f172a;
        margin-bottom: 20px;
        padding-bottom: 12px;
        border-bottom: 1px solid #e2e8f0;
        font-size: 18px;
        font-weight: 600;
    }

    .info-row {
        display: flex;
        padding: 12px 0;
        border-bottom: 1px solid #f1f5f9;
    }

    .info-row:last-child {
        border-bottom: none;
    }

    .info-label {
        font-weight: 600;
        color: #64748b;
        width: 150px;
        flex-shrink: 0;
        font-size: 14px;
    }

    .info-value {
        color: #0f172a;
        flex: 1;
        font-size: 14px;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        margin-bottom: 32px;
    }

    .stat-card {
        background: white;
        padding: 24px;
        border-radius: 8px;
        text-align: center;
        border: 1px solid #e2e8f0;
    }

    .stat-card h3 {
        color: #64748b;
        font-size: 12px;
        margin-bottom: 8px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .stat-value {
        font-size: 32px;
        font-weight: 700;
        color: #2563eb;
    }

    .term-scores {
        grid-column: 1 / -1;
    }

    .term-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 16px;
    }

    .term-table th {
        background: #f8fafc;
        padding: 12px;
        text-align: left;
        font-weight: 600;
        color: #0f172a;
        border-bottom: 1px solid #e2e8f0;
        font-size: 14px;
    }

    .term-table td {
        padding: 12px;
        border-bottom: 1px solid #f1f5f9;
        font-size: 14px;
    }

    .term-table tr:hover {
        background: #f8fafc;
    }

    .classification {
        padding: 4px 12px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
    }

    .classification.excellent {
        background: #d1fae5;
        color: #065f46;
    }

    .classification.good {
        background: #dbeafe;
        color: #1e40af;
    }

    .classification.average {
        background: #fef3c7;
        color: #92400e;
    }

    .classification.weak {
        background: #fee2e2;
        color: #991b1b;
    }

    .success-message {
        background: #f0fdf4;
        color: #166534;
        padding: 16px;
        border-radius: 8px;
        margin-bottom: 20px;
        border: 1px solid #bbf7d0;
    }

    @@media (max-width: 768px) {
        .profile-content {
            grid-template-columns: 1fr;
        }

        .stats-grid {
            grid-template-columns: 1fr;
        }

        .profile-header {
            flex-direction: column;
            text-align: center;
        }
    }
</style>

<div class="profile-container">
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="success-message">
            @TempData["SuccessMessage"]
        </div>
    }

    @if (!string.IsNullOrEmpty(ViewBag.ErrorMessage))
    {
        <div class="alert alert-danger">@ViewBag.ErrorMessage</div>
    }

    <!-- Profile Header -->
    <div class="profile-header">
        <div class="profile-avatar">
            @{
                var initial = Model != null && Model.FullName != null && Model.FullName.Length > 0
                ? Model.FullName.Substring(0, 1).ToUpper()
                : "S";
            }
            @initial
        </div>
        <div class="profile-info">
            @{
                var fullName = Model != null && Model.FullName != null ? Model.FullName : "Sinh vi√™n";
                var studentCode = Model != null && Model.StudentCode != null ? Model.StudentCode : "";
                var className = Model != null && Model.ClassName != null ? Model.ClassName : "";
            }
            <h1>@fullName</h1>
            <p><strong>M√£ sinh vi√™n:</strong> @studentCode</p>
            <p><strong>L·ªõp:</strong> @className</p>
            <div style="display: flex; gap: 10px; margin-top: 12px;">
                <a href="@Url.Action("EditProfile", "Student")" class="edit-btn">‚úèÔ∏è Ch·ªânh s·ª≠a th√¥ng tin</a>
                <a href="@Url.Action("ChangePassword", "Student")" class="edit-btn">üîê ƒê·ªïi m·∫≠t kh·∫©u</a>
            </div>
        </div>
    </div>

    <!-- Statistics -->
    <div class="stats-grid">
        <div class="stat-card">
            <h3>ƒêi·ªÉm TB R√®n Luy·ªán</h3>
            @{
                var avgScore = Model != null ? Model.AverageScore : 0;
            }
            <div class="stat-value">@avgScore.ToString("F1")</div>
        </div>
        <div class="stat-card">
            <h3>Ho·∫°t ƒê·ªông ƒê√£ ƒêƒÉng K√Ω</h3>
            @{
                var totalRegistered = Model != null ? Model.TotalActivitiesRegistered : 0;
            }
            <div class="stat-value">@totalRegistered</div>
        </div>
        <div class="stat-card">
            <h3>Ho·∫°t ƒê·ªông Ho√†n Th√†nh</h3>
            @{
                var totalCompleted = Model != null ? Model.TotalActivitiesCompleted : 0;
            }
            <div class="stat-value">@totalCompleted</div>
        </div>
    </div>

    <!-- Profile Content -->
    <div class="profile-content">
        <!-- Personal Information -->
        <div class="info-card">
            <h2>Th√¥ng Tin C√° Nh√¢n</h2>
            @{
                var email = Model != null && Model.Email != null ? Model.Email : "N/A";
                var phone = Model != null && Model.Phone != null ? Model.Phone : "N/A";
                var dob = Model != null && Model.DateOfBirth.HasValue
                ? Model.DateOfBirth.Value.ToString("dd/MM/yyyy")
                : "N/A";
                var gender = Model != null && Model.Gender != null ? Model.Gender : "N/A";
                var address = Model != null && Model.Address != null ? Model.Address : "N/A";
            }
            <div class="info-row">
                <span class="info-label">Email:</span>
                <span class="info-value">@email</span>
            </div>
            <div class="info-row">
                <span class="info-label">S·ªë ƒëi·ªán tho·∫°i:</span>
                <span class="info-value">@phone</span>
            </div>
            <div class="info-row">
                <span class="info-label">Ng√†y sinh:</span>
                <span class="info-value">@dob</span>
            </div>
            <div class="info-row">
                <span class="info-label">Gi·ªõi t√≠nh:</span>
                <span class="info-value">@gender</span>
            </div>
            <div class="info-row">
                <span class="info-label">ƒê·ªãa ch·ªâ:</span>
                <span class="info-value">@address</span>
            </div>
        </div>

        <!-- Academic Information -->
        <div class="info-card">
            <h2>Th√¥ng Tin H·ªçc T·∫≠p</h2>
            @{
                var deptName = Model != null && Model.DepartmentName != null ? Model.DepartmentName : "N/A";
                var deptCode = Model != null && Model.DepartmentCode != null ? Model.DepartmentCode : "";
                var classCode = Model != null && Model.ClassCode != null ? Model.ClassCode : "";
                var createdAt = Model != null ? Model.CreatedAt.ToString("dd/MM/yyyy") : "N/A";
                var status = Model != null && Model.IsActive ? "ƒêang ho·∫°t ƒë·ªông" : "Kh√¥ng ho·∫°t ƒë·ªông";
            }
            <div class="info-row">
                <span class="info-label">Khoa:</span>
                <span class="info-value">@deptName @(string.IsNullOrEmpty(deptCode) ? "" : "(" + deptCode + ")")</span>
            </div>
            <div class="info-row">
                <span class="info-label">M√£ l·ªõp:</span>
                <span class="info-value">@classCode</span>
            </div>
            <div class="info-row">
                <span class="info-label">Ng√†y t·∫°o t√†i kho·∫£n:</span>
                <span class="info-value">@createdAt</span>
            </div>
            <div class="info-row">
                <span class="info-label">Tr·∫°ng th√°i:</span>
                <span class="info-value">@status</span>
            </div>
        </div>

        <!-- Term Scores -->
        <div class="info-card term-scores">
            <h2>ƒêi·ªÉm R√®n Luy·ªán Theo H·ªçc K·ª≥</h2>
            @if (Model != null && Model.TermScores != null && Model.TermScores.Any())
            {
                <table class="term-table">
                    <thead>
                        <tr>
                            <th>H·ªçc k·ª≥</th>
                            <th>NƒÉm h·ªçc</th>
                            <th>T·ªïng ƒëi·ªÉm</th>
                            <th>X·∫øp lo·∫°i</th>
                            <th>Ng√†y duy·ªát</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var term in Model.TermScores)
                        {
                            <tr>
                                <td>@term.TermName</td>
                                <td>@term.TermYear</td>
                                <td><strong>@term.TotalScore</strong></td>
                                <td>
                                    @{
                                        var classificationClass = "classification";
                                        var classification = term.Classification;

                                        if (classification != null)
                                        {
                                            if (classification.Contains("Xu·∫•t s·∫Øc") || classification.Contains("EXCELLENT"))
                                            {
                                                classificationClass += " excellent";
                                            }
                                            else if (classification.Contains("T·ªët") || classification.Contains("GOOD"))
                                            {
                                                classificationClass += " good";
                                            }
                                            else if (classification.Contains("Kh√°") || classification.Contains("AVERAGE"))
                                            {
                                                classificationClass += " average";
                                            }
                                            else if (classification.Contains("Y·∫øu") || classification.Contains("WEAK"))
                                            {
                                                classificationClass += " weak";
                                            }
                                        }
                                    }
                                    <span class="@classificationClass">@classification</span>
                                </td>
                                <td>
                                    @{
                                        var approvedDate = term.ApprovedAt.HasValue
                                        ? term.ApprovedAt.Value.ToString("dd/MM/yyyy")
                                        : "Ch∆∞a duy·ªát";
                                    }
                                    @approvedDate
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <p style="color: #94a3b8; text-align: center; padding: 20px;">Ch∆∞a c√≥ ƒëi·ªÉm r√®n luy·ªán</p>
            }
        </div>
    </div>
</div>