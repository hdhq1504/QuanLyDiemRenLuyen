@model QuanLyDiemRenLuyen.Models.ActivityListViewModel
@{
    ViewBag.Title = "Danh sách hoạt động";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .activities-container {
        padding: 24px;
        background: #f8fafc;
        min-height: 100vh;
    }

    .page-header {
        background: #2563eb;
        color: white;
        padding: 32px;
        border-radius: 8px;
        margin-bottom: 32px;
        border: 1px solid #e2e8f0;
    }

    .page-header h1 {
        margin: 0 0 8px 0;
        font-size: 28px;
        font-weight: 600;
    }

    .page-header p {
        margin: 0;
        font-size: 14px;
        opacity: 0.9;
    }

    .search-filter-section {
        background: white;
        padding: 24px;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
        margin-bottom: 32px;
    }

    .search-filter-form {
        display: grid;
        grid-template-columns: 2fr 1fr auto;
        gap: 20px;
        align-items: end;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #64748b;
        font-size: 14px;
    }

    .form-control {
        width: 100%;
        padding: 12px;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        font-size: 14px;
        transition: all 0.2s;
    }

    .form-control:focus {
        outline: none;
        border-color: #2563eb;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        text-decoration: none;
    }

    .btn-primary {
        background: #2563eb;
        color: white;
    }

    .btn-primary:hover {
        background: #1e40af;
    }

    .btn-secondary {
        background: #f1f5f9;
        color: #475569;
    }

    .btn-secondary:hover {
        background: #e2e8f0;
        color: #1e293b;
    }

    .activities-grid {
        display: grid;
        gap: 20px;
    }

    .activity-card {
        background: white;
        border-radius: 8px;
        padding: 24px;
        border: 1px solid #e2e8f0;
        transition: all 0.2s;
    }

    .activity-card:hover {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    .activity-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 16px;
    }

    .activity-title {
        font-size: 18px;
        font-weight: 600;
        color: #0f172a;
        margin-bottom: 12px;
        line-height: 1.4;
    }

    .activity-meta {
        display: flex;
        gap: 24px;
        flex-wrap: wrap;
        margin-bottom: 16px;
        font-size: 14px;
        color: #64748b;
    }

    .meta-item {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .meta-item i {
        color: #94a3b8;
    }

    .badge {
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 6px;
    }

    .badge-success { background: #d1fae5; color: #065f46; }
    .badge-warning { background: #fef3c7; color: #92400e; }
    .badge-info { background: #dbeafe; color: #1e40af; }
    .badge-danger { background: #fee2e2; color: #991b1b; }
    .badge-secondary { background: #f1f5f9; color: #475569; }

    .activity-description {
        color: #475569;
        margin-bottom: 20px;
        line-height: 1.6;
        font-size: 14px;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .activity-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-top: 20px;
        border-top: 1px solid #f1f5f9;
    }

    .participants-info {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #64748b;
        font-size: 14px;
    }

    .progress-bar {
        width: 100px;
        height: 6px;
        background: #e2e8f0;
        border-radius: 3px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        background: #2563eb;
        border-radius: 3px;
    }

    .pagination {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-top: 32px;
    }

    .pagination a, .pagination span {
        padding: 8px 16px;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        text-decoration: none;
        color: #64748b;
        font-weight: 500;
        font-size: 14px;
        background: white;
        transition: all 0.2s;
    }

    .pagination a:hover {
        border-color: #2563eb;
        color: #2563eb;
    }

    .pagination .active {
        background: #2563eb;
        color: white;
        border-color: #2563eb;
    }

    .no-activities {
        text-align: center;
        padding: 64px;
        background: white;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
    }

    .no-activities i {
        font-size: 48px;
        color: #e2e8f0;
        margin-bottom: 16px;
    }

    .no-activities h3 {
        color: #0f172a;
        margin-bottom: 8px;
    }

    .no-activities p {
        color: #64748b;
    }

    @@media (max-width: 768px) {
        .search-filter-form {
            grid-template-columns: 1fr;
        }
        
        .activity-meta {
            gap: 16px;
        }
    }
</style>

<div class="activities-container">
    <div class="page-header">
        <h1><i class="fas fa-calendar-alt"></i> Danh sách hoạt động</h1>
        <p>Tìm kiếm và đăng ký tham gia các hoạt động rèn luyện</p>
    </div>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success">
            <i class="fas fa-check-circle"></i> @TempData["SuccessMessage"]
        </div>
    }
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger">
            <i class="fas fa-exclamation-circle"></i> @TempData["ErrorMessage"]
        </div>
    }

    <!-- Search and Filter Section -->
    <div class="search-filter-section">
        @using (Html.BeginForm("Index", "Activities", FormMethod.Get))
        {
            <div class="search-filter-form">
                <div class="form-group">
                    <label for="search">Tìm kiếm</label>
                    <input type="text" name="search" id="search" class="form-control" 
                           placeholder="Nhập tên hoạt động..." value="@Model.SearchKeyword" />
                </div>
                <div class="form-group">
                    <label for="status">Trạng thái</label>
                    <select name="status" id="status" class="form-control">
                        <option value="ALL" @(Model.FilterStatus == "ALL" ? "selected" : "")>Tất cả trạng thái</option>
                        <option value="UPCOMING" @(Model.FilterStatus == "UPCOMING" ? "selected" : "")>Sắp diễn ra</option>
                        <option value="ONGOING" @(Model.FilterStatus == "ONGOING" ? "selected" : "")>Đang diễn ra</option>
                        <option value="COMPLETED" @(Model.FilterStatus == "COMPLETED" ? "selected" : "")>Đã kết thúc</option>
                    </select>
                </div>
                <div class="form-group" style="display: flex; gap: 12px;">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-search"></i> Tìm kiếm
                    </button>
                    <a href="@Url.Action("Index", "Activities")" class="btn btn-secondary">
                        <i class="fas fa-undo"></i> Đặt lại
                    </a>
                </div>
            </div>
        }
    </div>

    <!-- Activities List -->
    @if (Model.Activities != null && Model.Activities.Count > 0)
    {
        <div class="activities-grid">
            @foreach (var activity in Model.Activities)
            {
                <div class="activity-card">
                    <div class="activity-header">
                        <div>
                            <h3 class="activity-title">@activity.Title</h3>
                            <div class="activity-meta">
                                <span class="meta-item">
                                    <i class="far fa-calendar"></i> 
                                    @activity.StartAt.ToString("dd/MM/yyyy HH:mm")
                                </span>
                                <span class="meta-item">
                                    <i class="fas fa-map-marker-alt"></i> 
                                    @activity.Location
                                </span>
                                <span class="meta-item">
                                    <i class="fas fa-star"></i> 
                                    @(activity.Points ?? 0) điểm
                                </span>
                                @if (!string.IsNullOrEmpty(activity.CategoryName))
                                {
                                    <span class="meta-item">
                                        <i class="fas fa-tag"></i> 
                                        @activity.CategoryName
                                    </span>
                                }
                            </div>
                        </div>
                        <div>
                            @if (activity.IsRegistered)
                            {
                                if (activity.RegistrationStatus == "PENDING")
                                {
                                    <span class="badge badge-warning"><i class="fas fa-clock"></i> Chờ duyệt</span>
                                }
                                else if (activity.RegistrationStatus == "APPROVED")
                                {
                                    <span class="badge badge-success"><i class="fas fa-check"></i> Đã duyệt</span>
                                }
                                else if (activity.RegistrationStatus == "CHECKED_IN")
                                {
                                    <span class="badge badge-info"><i class="fas fa-user-check"></i> Đã tham gia</span>
                                }
                                else if (activity.RegistrationStatus == "REJECTED")
                                {
                                    <span class="badge badge-danger"><i class="fas fa-times"></i> Bị từ chối</span>
                                }
                            }
                            else
                            {
                                if (activity.Status == "ACTIVE")
                                {
                                    if (activity.CurrentParticipants >= activity.MaxParticipants)
                                    {
                                        <span class="badge badge-danger"><i class="fas fa-users-slash"></i> Đã đủ người</span>
                                    }
                                    else if (activity.RegistrationDeadline.HasValue && activity.RegistrationDeadline < DateTime.Now)
                                    {
                                        <span class="badge badge-secondary"><i class="fas fa-clock"></i> Hết hạn ĐK</span>
                                    }
                                    else
                                    {
                                        <span class="badge badge-success"><i class="fas fa-check-circle"></i> Có thể đăng ký</span>
                                    }
                                }
                                else
                                {
                                    <span class="badge badge-secondary">@activity.Status</span>
                                }
                            }
                        </div>
                    </div>

                    <p class="activity-description">
                        @(activity.Description.Length > 200 ? activity.Description.Substring(0, 200) + "..." : activity.Description)
                    </p>

                    <div class="activity-footer">
                        <div class="participants-info">
                            @{
                                var percent = activity.MaxParticipants > 0 
                                    ? (double)activity.CurrentParticipants / activity.MaxParticipants * 100 
                                    : 0;
                            }
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: @percent%"></div>
                            </div>
                            <span>@activity.CurrentParticipants/@activity.MaxParticipants người tham gia</span>
                        </div>
                        <a href="@Url.Action("Detail", "Activities", new { id = activity.Id })" class="btn btn-primary">
                            Xem chi tiết <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
            }
        </div>

        <!-- Pagination -->
        if (Model.TotalPages > 1)
        {
            <div class="pagination">
                @if (Model.CurrentPage > 1)
                {
                    <a href="@Url.Action("Index", "Activities", new { search = Model.SearchKeyword, status = Model.FilterStatus, page = Model.CurrentPage - 1 })">
                        <i class="fas fa-chevron-left"></i> Trước
                    </a>
                }

                @for (int i = 1; i <= Model.TotalPages; i++)
                {
                    if (i == Model.CurrentPage)
                    {
                        <span class="active">@i</span>
                    }
                    else
                    {
                        <a href="@Url.Action("Index", "Activities", new { search = Model.SearchKeyword, status = Model.FilterStatus, page = i })">@i</a>
                    }
                }

                @if (Model.CurrentPage < Model.TotalPages)
                {
                    <a href="@Url.Action("Index", "Activities", new { search = Model.SearchKeyword, status = Model.FilterStatus, page = Model.CurrentPage + 1 })">
                        Sau <i class="fas fa-chevron-right"></i>
                    </a>
                }
            </div>
        }
    }
    else
    {
        <div class="no-activities">
            <i class="fas fa-search"></i>
            <h3>Không tìm thấy hoạt động nào</h3>
            <p>Vui lòng thử lại với từ khóa khác hoặc thay đổi bộ lọc</p>
        </div>
    }
</div>